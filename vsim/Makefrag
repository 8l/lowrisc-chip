#--------------------------------------------------------------------
# Sources
#--------------------------------------------------------------------

# Verilog sources

sim_vsrcs = \
	$(generated_dir)/$(MODEL).$(CONFIG).v \
	$(generated_dir)/consts.$(CONFIG).vh \

#--------------------------------------------------------------------
# Build Verilog
#--------------------------------------------------------------------

verilog: $(sim_vsrcs)

.PHONY: verilog

#--------------------------------------------------------------------
# Build rules (verilator)
#--------------------------------------------------------------------
veri = verilator
tb_top = chip_top

veri_flags = \
	+incdir+$(generated_dir) \
	+incdir+$(base_dir)/vsrc \
	+incdir+$(base_dir)/csrc/veri \
	--top-module $(tb_top) \
	--unroll-count 256 \
	-Wno-lint -Wno-style -Wno-STMTDLY \
	--exe \
	--trace \
	 -CFLAGS "-g" \
	--Mdir $(sim_dir)/verilator

veri_vsrcs = \
	$(base_dir)/vsrc/chip_top.sv \
	$(generated_dir)/$(MODEL).$(CONFIG).v \
	$(base_dir)/vsrc/axi_ram_behav.sv \
	$(base_dir)/vsrc/host_behav.sv \
	$(base_dir)/socip/nasti/channel.sv \

veri_csrcs = \
	$(base_dir)/csrc/veri/dpi_ram_behav.cpp \
	$(base_dir)/csrc/veri/dpi_host_behav.cpp \
	$(base_dir)/csrc/veri/veri_top.cc \

#--------------------------------------------------------------------
# Build the simulator (verilator)
#--------------------------------------------------------------------
verilator: verilator.log
verilator.log: $(sim_vsrcs) $(veri_vsrcs) $(veri_csrcs)
	$(veri) --cc $(veri_vsrcs) $(veri_csrcs) $(veri_flags) -o ../$(CONFIG)-sim | tee $@

sim: $(CONFIG)-sim
$(CONFIG)-sim: verilator.log
	cd verilator && make -f V$(tb_top).mk

.PHONY: verilator sim

# emacs local variable

# Local Variables:
# mode: makefile
# End:
