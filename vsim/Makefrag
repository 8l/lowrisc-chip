#--------------------------------------------------------------------
# Sources
#--------------------------------------------------------------------

# Verilog sources

sim_vsrcs = \
	$(generated_dir)/$(MODEL).$(CONFIG).v \
	$(generated_dir)/consts.$(CONFIG).vh \

#--------------------------------------------------------------------
# Build Verilog
#--------------------------------------------------------------------

verilog: $(sim_vsrcs)

.PHONY: verilog

#--------------------------------------------------------------------
# Build rules (verilator)
#--------------------------------------------------------------------
veri = verilator
veri_flags = +incdir+$(generated_dir) --unroll-count 256 -Wno-lint -Wno-style -Wno-STMTDLY --exe --Mdir $(sim_dir)
tb_top = chip_top
veri_vtop = $(base_dir)/vsrc/chip_top.sv
veri_vsrcs = \
	$(generated_dir)/$(MODEL).$(CONFIG).v \

veri_csrcs = \
	$(base_dir)/csrc/veri/veri_top.cc \

#--------------------------------------------------------------------
# Build the simulator (verilator)
#--------------------------------------------------------------------
verilator: V$(tb_top)__verFiles.dat
V$(tb_top)__verFiles.dat: $(sim_vsrcs)
	$(veri) --cc $(veri_vtop) $(veri_vsrcs) $(veri_csrcs) $(veri_flags) -o $(CONFIG)-sim

sim: $(CONFIG)-sim
$(CONFIG)-sim: V$(tb_top)__verFiles.dat
	make -f V$(tb_top).mk

.PHONY: verilator sim

# emacs local variable

# Local Variables:
# mode: makefile
# End:
